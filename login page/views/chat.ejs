<%- include("headerchat.ejs") %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
</head>
<body>
    
    <div class="Chat-index">
        <header>
            <h2 class="Profile-heading">Chats</h2><br>
            <div class="search-bar">
                <i class="bi bi-search"></i>
                <input type="text" name="new-contact" class="form-control" placeholder="Search users">
            </div>
            <h4 class="Profile-heading">Recent</h4>
            <hr> 
        </header>
        <div class="chatting-users">
            <% if (contactsArray.length > 0) { %>
                <% contactsArray.forEach(contact => { %>
                    <div class="user-box">
                        <div class="user-profile-pic">
                            <img src="profilepic.png" alt="Profile Picture">
                        </div>
                        <div class="user-info">
                            <div class="username"><button class="user-contact" id="<%= contact.name %>" onclick="openMainChat('<%= contact.name %>')"><%= contact.name %></button></div>
                            <div class="last-chat">Hello there!</div>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <!-- Show message if no contacts available -->
                <p>No contacts added yet.</p>
            <% } %>
        </div>
    </div>
    <div class="chat-area">
        <div class="chat-icon-container">
            <i class="bi bi-chat-left-fill chat-icon"></i>
        </div>
        <h1>Start Conversation</h1>
    </div>
    <%- include("mainchat.ejs") %>

    <script>
    function sendMessage() {
        // Get the message input
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();

        // Clear the message input
        messageInput.value = '';

        // Create a new chat message element
        const chatMessages = document.getElementById('chatMessages');
        const messageElement = document.createElement('div');
        messageElement.textContent = message;
        messageElement.classList.add('right-chat'); // Assuming it's a left-aligned message
        chatMessages.appendChild(messageElement);

        // Scroll to the bottom of the chat messages
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Add event listener to the send button
    document.addEventListener('DOMContentLoaded', function() {
        const sendButton = document.getElementById('sendButton');
        sendButton.addEventListener('click', sendMessage);
    });




            // Select the three-dot icon and the options menu
            const optionsButton = document.getElementById('optionsButton');
            const optionsMenu = document.getElementById('optionsMenu');
        
            // Toggle the display of the options menu when the three-dot icon is clicked
            optionsButton.addEventListener('click', () => {
                optionsMenu.style.display = optionsMenu.style.display === 'none' ? 'block' : 'none';
            });


        

        // userBoxes.forEach(userBox => {
        //     userBox.addEventListener('click', () => {
        //         const userName = userBox.querySelector('.user-name').innerText;
        //         openMainChat(userName);
        //     });
        // });

        // Function to open the main chat box
        function openMainChat(userName) {
            // Hide the "Start Conversation" section
            document.querySelector('.chat-area').style.display = 'none';

            // Show the main chat box
            document.querySelector('.main-chat-container').style.display = 'block';

            // Update the user name in the main chat box with the selected contact's name
            document.querySelector('.user-name').innerText = userName;

            // You can perform additional actions here, such as loading previous messages or other functionalities.
        }
    </script>  
</body>
</html>
